<style>
    .wrapper {
        position: relative;
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

    .signature-pad {
        background-color: white;
        border: 1px solid gray;
    }

    #output {
        border: 1px solid gray;
    }
</style>
<div class="wrapper">
    <canvas id="signature-pad" class="signature-pad" width=1024 height=1024></canvas>
</div>

<button id="save-png">Save as PNG</button>
<button id="undo">Undo</button>
<button id="clear">Clear</button>

<div>
    <img id="output"></img>
</div>

<!-- Source: https://github.com/szimek/signature_pad -->
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
<script>
    const canvas = document.querySelector("canvas");
    const signaturePad = new SignaturePad(canvas, {
        backgroundColor: 'rgb(255, 255, 255)', // set background color to white
    });

    document.getElementById('save-png').addEventListener('click', async function () {
        if (signaturePad.isEmpty()) {
            return alert("Please provide a signature first.");
        }

        var data = signaturePad.toDataURL('image/jpg');

        const requestPayload = {
            scribble_control_png_b64: data,
        }

        const response = await fetch("/generate", {
            method: 'POST',
            mode: "cors",
            cache: "no-cache",
            credentials: "same-origin",
            headers: {"Content-Type": "application/json"},
            referrerPolicy: "no-referrer",
            body: JSON.stringify(requestPayload),
        })
        const respData = await response.json();
        console.log(respData['message']);

        const outputImg = document.getElementById('output');
        if (outputImg) {
            outputImg.src = respData['img_b64'];
        }

        // var download = document.createElement('a');
        // download.href = data;
        // download.download = 'signature.png';
        // download.click();
    });

    document.getElementById('clear').addEventListener('click', function () {
        signaturePad.clear();
    });

    document.getElementById('undo').addEventListener('click', function () {
        var data = signaturePad.toData();
        if (data) {
            data.pop(); // remove the last dot or line
            signaturePad.fromData(data);
        }
    });
</script>