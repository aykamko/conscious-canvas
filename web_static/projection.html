<head>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>

<div class="creation-container flex-center">
    <div>
        <div class="create-progress-container">
            <div class="center-text">
                Creating your Art...
            </div>
            <progress id="create-progress" value="0" max="100"></progress>
        </div>

        <div class="creation-output">
            <img id="output" />
        </div>
    </div>
</div>

<script src="js/lib.js"></script>
<script>
    const wsUrl = `wss://${window.location.host}/projection-ws`;
    const ws = new WebSocket(wsUrl);

    const creationOutputContainer = document.querySelector(".creation-output");
    const progressBarContainer = document.querySelector(".create-progress-container");
    const progressBar = document.getElementById("create-progress");

    ws.onmessage = function (event) {
        const eventData = JSON.parse(event.data ?? '{}');
        const eventType = eventData.event_type;

        switch (eventType) {
            case "GENERATION_STARTING": {
                showElement(progressBarContainer);
                updateProgressOverNSeconds(progressBar, AVG_SEC_TO_CREATE);
                break;
            }
            case "NEW_ARTWORK_AVAILABLE": {
                hideElement(progressBarContainer);
                const outputImg = document.getElementById("output");
                if (eventData.image_b64) {
                    outputImg.src = eventData.image_b64;
                    showElement(creationOutputContainer);
                }
                break;
            }
        }

    };
</script>