<head>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .create-progress-container {
            margin: 32px 0;
        }
    </style>
</head>

<div class="creation-container flex-center">
    <div>
        <div class="create-progress-container">
            <div class="center-text">
                Creating your Masterpiece...
            </div>
            <progress id="create-progress" value="0" max="100"></progress>
        </div>

        <div class="creation-output">
            <img id="output" />
        </div>

        <div id="prompt-container" class="prompt-container">
            <div><span id="prompt">Waiting for a prompt...</span></div>
        </div>
    </div>
</div>

<script src="js/lib.js"></script>
<script>
    window.addEventListener("scroll", (e) => {
        e.preventDefault();
        window.scrollTo(0, 0);
    });

    const wsUrl = `wss://${window.location.host}/projection-ws`;
    const ws = new WebSocket(wsUrl);

    const creationOutputContainer = document.querySelector(".creation-output");
    const progressBarContainer = document.querySelector(".create-progress-container");
    const progressBar = document.getElementById("create-progress");
    const promptContainer = document.getElementById("prompt-container");

    promptContainer.style.color = "gray"; // set to gray initially

    ws.onmessage = function (event) {
        const eventData = JSON.parse(event.data ?? '{}');
        const eventType = eventData.event_type;

        switch (eventType) {
            case "GENERATION_STARTING": {
                promptContainer.textContent = eventData.prompt;
                promptContainer.style.removeProperty('color');
                showElement(progressBarContainer);
                updateProgressOverNSeconds(progressBar, AVG_SEC_TO_CREATE);
                break;
            }
            case "NEW_ARTWORK_AVAILABLE": {
                hideElement(progressBarContainer);
                const outputImg = document.getElementById("output");
                outputImg.src = eventData.image_b64;
                promptContainer.textContent = eventData.prompt;
                promptContainer.style.removeProperty('color');
                break;
            }
        }

    };
</script>