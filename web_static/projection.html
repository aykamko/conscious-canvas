<head>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: black;
            color: white;
        }
    </style>
</head>

<div class="creation-container">
    <div class="create-progress-container">
        <div class="center-text">
            Creating your Masterpiece ðŸŽ¨
        </div>
        <progress id="create-progress" value="0" max="100"></progress>
    </div>

    <img id="output" />

    <div id="prompt-container" class="prompt-container">
        <div><span id="prompt">Waiting for your masterpiece âœ¨</span></div>
    </div>
</div>

<script src="js/lib.js"></script>
<script>
    window.addEventListener("scroll", (e) => {
        e.preventDefault();
        window.scrollTo(0, 0);
    });

    const wsProtocol = window.location.protocol === "https:" ? "wss" : "ws";
    const wsUrl = `${wsProtocol}://${window.location.host}/projection-ws`;
    const ws = new WebSocket(wsUrl);

    const creationOutputContainer = document.querySelector(".creation-output");
    const progressBarContainer = document.querySelector(".create-progress-container");
    const progressBar = document.getElementById("create-progress");
    const promptContainer = document.getElementById("prompt-container");

    promptContainer.style.color = "gray"; // set to gray initially

    ws.onmessage = function (event) {
        const eventData = JSON.parse(event.data ?? '{}');
        const eventType = eventData.event_type;

        switch (eventType) {
            case "GENERATION_STARTING": {
                promptContainer.textContent = eventData.prompt;
                promptContainer.style.removeProperty('color');
                showElement(progressBarContainer);
                updateProgressOverNSeconds(progressBar, AVG_SEC_TO_CREATE);
                break;
            }
            case "ARTWORK_GENERATED": {
                hideElement(progressBarContainer);
                const outputImg = document.getElementById("output");
                outputImg.src = eventData.image_b64;
                promptContainer.textContent = eventData.prompt;
                promptContainer.style.removeProperty('color');
                break;
            }
        }

    };
</script>